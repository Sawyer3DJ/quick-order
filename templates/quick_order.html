<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quick Order â€” Table {{ table_num }}</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom right, #FF6A13, #1a1a1a) fixed no-repeat;
      background-size: cover;
      color: white; margin: 0; padding: 0;
    }
    .container {
      max-width: 600px; margin: 30px auto;
      padding: 20px; background: #222;
      border-radius: 10px; display: none;
    }
    .container.active { display: block; }
    h1, h2 { color: #FF6A13; margin-bottom: 10px; }
    .menu-list {
      list-style: none; margin: 0; padding: 0;
    }
    .menu-item {
      display: flex; align-items: center;
      border-bottom: 1px solid #444;
      padding: 10px 0;
    }
    .menu-item:last-child { border-bottom: none; }
    .item-label { flex: 2; }
    .item-size { flex: 1; margin: 0 5px; }
    .item-price { flex: 1; text-align: right; }
    .add-btn {
      flex: 0; width: 36px; height: 36px;
      background: #28a745; color: white;
      border: none; border-radius: 50%;
      font-size: 1.2em; line-height: 36px;
      text-align: center; cursor: pointer;
      margin-left: 10px;
    }
    #orderList { margin-top: 20px; }
    .order-item {
      display: flex; justify-content: space-between;
      align-items: center; margin: 5px 0;
    }
    .order-item span { font-size: 1.05em; }
    .remove-btn {
      background: #dc3545; color: white;
      border: none; border-radius: 5px;
      padding: 5px 10px; cursor: pointer;
    }
    #total {
      text-align: right; font-weight: bold;
      margin-top: 10px; font-size: 1.1em;
    }
    textarea {
      width: 100%; height: 60px; margin-top: 10px;
      font-size: 1em; padding: 5px; border-radius: 5px;
      border: 1px solid #444; background: #333; color: #fff;
    }
    button.submit {
      width: 100%; margin-top: 15px;
      background: #28a745; color: white;
    }
    button.grey, button.goBack {
      background: #888; color: white;
    }
    button.newOrder {
      background: #28a745; color: white;
      display: block; margin: 20px auto 0;
    }
    .divider {
      margin: 30px 0 10px; border-top: 1px solid #444;
    }
  </style>
</head>
<body>

  <!-- Welcome -->
  <div class="container active" id="welcomePage">
    <h1>Welcome â€” Table {{ table_num }}</h1>
    <button class="add-btn" onclick="startOrder()" style="background:#FF6A13">GO</button>
  </div>

  <!-- Menu -->
  <div class="container" id="menuPage">
    <h1>Quick Order Menu</h1>
    <ul class="menu-list">
      <!-- Loaded Fries -->
      <li class="menu-item">
        <span class="item-label">Loaded Fries</span>
        <select id="loadedFries" class="item-size"
                onchange="updatePrice('Loaded Fries','loadedFries','price-loadedFries')">
          <option>Regular</option><option>Large</option>
        </select>
        <span id="price-loadedFries" class="item-price">Â£3.00</span>
        <button class="add-btn" onclick="addItem('Loaded Fries','loadedFries')">+</button>
      </li>
      <!-- Onion Rings -->
      <li class="menu-item">
        <span class="item-label">Onion Rings</span>
        <select id="onionRings" class="item-size"
                onchange="updatePrice('Onion Rings','onionRings','price-onionRings')">
          <option>Regular</option><option>Large</option>
        </select>
        <span id="price-onionRings" class="item-price">Â£2.50</span>
        <button class="add-btn" onclick="addItem('Onion Rings','onionRings')">+</button>
      </li>
      <!-- Korean Fries -->
      <li class="menu-item">
        <span class="item-label">Korean Chicken Fries</span>
        <select id="koreanFries" class="item-size"
                onchange="updatePrice('Korean Chicken Fries','koreanFries','price-koreanFries')">
          <option>Regular</option><option>Large</option>
        </select>
        <span id="price-koreanFries" class="item-price">Â£4.00</span>
        <button class="add-btn" onclick="addItem('Korean Chicken Fries','koreanFries')">+</button>
      </li>
      <!-- Loaded Nachos -->
      <li class="menu-item">
        <span class="item-label">Loaded Nachos</span>
        <select id="nachos" class="item-size"
                onchange="updatePrice('Loaded Nachos','nachos','price-nachos')">
          <option>Regular</option><option>Large</option>
        </select>
        <span id="price-nachos" class="item-price">Â£4.50</span>
        <button class="add-btn" onclick="addItem('Loaded Nachos','nachos')">+</button>
      </li>
      <!-- Beer -->
      <li class="menu-item">
        <span class="item-label">Beer</span>
        <select id="beer" class="item-size"
                onchange="updatePrice('Beer','beer','price-beer')">
          <option>Half Pint</option><option>Pint</option>
        </select>
        <span id="price-beer" class="item-price">Â£2.00</span>
        <button class="add-btn" onclick="addItem('Beer','beer')">+</button>
      </li>
      <!-- Red Wine -->
      <li class="menu-item">
        <span class="item-label">Red Wine</span>
        <select id="redWine" class="item-size"
                onchange="updatePrice('Red Wine','redWine','price-redWine')">
          <option>Small</option><option>Large</option><option>Bottle</option>
        </select>
        <span id="price-redWine" class="item-price">Â£3.50</span>
        <button class="add-btn" onclick="addItem('Red Wine','redWine')">+</button>
      </li>
      <!-- White Wine -->
      <li class="menu-item">
        <span class="item-label">White Wine</span>
        <select id="whiteWine" class="item-size"
                onchange="updatePrice('White Wine','whiteWine','price-whiteWine')">
          <option>Small</option><option>Large</option><option>Bottle</option>
        </select>
        <span id="price-whiteWine" class="item-price">Â£3.50</span>
        <button class="add-btn" onclick="addItem('White Wine','whiteWine')">+</button>
      </li>
    </ul>

    <div class="order-list" id="orderList"></div>
    <div id="total">Total: Â£0.00</div>

    <textarea id="comments" placeholder="Comments or allergies?"></textarea>
    <button class="submit" onclick="reviewOrder()">Review Order</button>
  </div>

  <!-- Review -->
  <div class="container" id="reviewPage">
    <h1>Your Order</h1>
    <div id="reviewSummary"></div>
    <div class="divider"></div>
    <button class="goBack" onclick="goBack()">Go Back</button>
    <button class="submit" onclick="placeOrder()">Place Order</button>
  </div>

  <!-- Success -->
  <div class="container" id="successPage">
    <h1>Order Placed!</h1>
    <p>Table {{ table_num }} â€” Order #<span id="orderNumber">0000</span></p>
    <p>Please have payment ready.</p>
    <button class="newOrder" onclick="startOrder()">New Quick Order</button>
  </div>

  <script>
    const tableNum   = {{ table_num }},
          endpoint   = "{{ url_for('receive_order') }}",
          testurl    = "{{ url_for('test') }}",
          prices     = {
            "Loaded Fries Regular":3.00, "Loaded Fries Large":4.50,
            "Onion Rings Regular":2.50, "Onion Rings Large":3.50,
            "Korean Chicken Fries Regular":4.00, "Korean Chicken Fries Large":5.50,
            "Loaded Nachos Regular":4.50, "Loaded Nachos Large":6.00,
            "Beer Half Pint":2.00, "Beer Pint":3.80,
            "Red Wine Small":3.50, "Red Wine Large":5.00, "Red Wine Bottle":12.00,
            "White Wine Small":3.50, "White Wine Large":5.00, "White Wine Bottle":12.00
          };
    let order = [];

    function startOrder() {
      order = [];
      renderOrder();
      document.querySelectorAll('.container').forEach(c=>c.classList.remove('active'));
      document.getElementById('menuPage').classList.add('active');
      // initialize prices
      updateAllPrices();
    }

    function updatePrice(name, sizeId, priceId) {
      const size = document.getElementById(sizeId).value,
            key  = name + " " + size,
            p    = prices[key]||0;
      document.getElementById(priceId).innerText = "Â£" + p.toFixed(2);
    }

    function updateAllPrices(){
      ["loadedFries","onionRings","koreanFries","nachos","beer","redWine","whiteWine"]
        .forEach(id=>{
          const map = {
            loadedFries: "Loaded Fries",
            onionRings: "Onion Rings",
            koreanFries: "Korean Chicken Fries",
            nachos: "Loaded Nachos",
            beer: "Beer",
            redWine: "Red Wine",
            whiteWine: "White Wine"
          };
          updatePrice(map[id], id, "price-"+id);
        });
    }

    function addItem(name, sizeId) {
      const size = document.getElementById(sizeId).value,
            full = name + " " + size;
      const ex = order.find(i=>i.name===full);
      if(ex) ex.quantity++; else order.push({ name: full, quantity: 1 });
      renderOrder();
    }

    function removeItem(i) {
      if(--order[i].quantity === 0) order.splice(i,1);
      renderOrder();
    }

    function renderOrder() {
      const list = document.getElementById('orderList');
      list.innerHTML = '';
      let total=0;
      order.forEach((it,i)=>{
        const cost = (prices[it.name]||0)*it.quantity;
        total += cost;
        list.innerHTML += `
          <div class="order-item">
            <span>${it.quantity}Ã— ${it.name} (Â£${cost.toFixed(2)})</span>
            <button class="remove-btn" onclick="removeItem(${i})">ðŸ—‘</button>
          </div>`;
      });
      document.getElementById('total').textContent = 
        'Total: Â£' + total.toFixed(2);
    }

    function reviewOrder() {
      const summary = order.map(i=>`${i.quantity}Ã— ${i.name}`).join('<br>'),
            comments= document.getElementById('comments').value,
            total   = order.reduce((s,i)=>s + ((prices[i.name]||0)*i.quantity),0).toFixed(2);
      document.getElementById('reviewSummary').innerHTML = `
        ${summary}<br><br>
        <strong>Comments:</strong> ${comments}<br><br>
        <strong>Total:</strong> Â£${total}`;
      document.querySelectorAll('.container').forEach(c=>c.classList.remove('active'));
      document.getElementById('reviewPage').classList.add('active');
    }

    function goBack(){
      document.querySelectorAll('.container').forEach(c=>c.classList.remove('active'));
      document.getElementById('menuPage').classList.add('active');
    }

    function placeOrder(){
      const comments = document.getElementById('comments').value,
            orderNum  = Math.floor(1000+Math.random()*9000);
      fetch(endpoint,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ table:tableNum, order, comments, orderNum })
      })
      .then(r=>{ if(!r.ok) throw ""; return r.json(); })
      .then(_=>{
        document.getElementById('orderNumber').innerText = orderNum;
        document.querySelectorAll('.container').forEach(c=>c.classList.remove('active'));
        document.getElementById('successPage').classList.add('active');
      })
      .catch(e=>alert('Order failed'));
    }

    function pingServer(){
      fetch(testurl)
        .then(r=>r.text())
        .then(msg=>document.getElementById('pingResult').innerText = 'âœ“ '+msg)
        .catch(_=>document.getElementById('pingResult').innerText = 'âœ— Cannot reach server');
    }
  </script>
</body>
</html>
