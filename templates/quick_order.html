<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quick Order â€” Table {{ table_num }}</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom right, #FF6A13, #1a1a1a) fixed no-repeat;
      background-size: cover;
      color: white;
      margin: 0; padding: 0;
    }
    .container {
      max-width: 600px;
      margin: 30px auto;
      padding: 20px;
      background: #222;
      border-radius: 10px;
      display: none;
    }
    .container.active { display: block; }
    h1, h2 { color: #FF6A13; margin-bottom: 10px; }
    .menu-list { list-style: none; margin: 0; padding: 0; }
    .menu-item {
      display: flex; align-items: center;
      border-bottom: 1px solid #444; padding: 10px 0;
    }
    .menu-item:last-child { border-bottom: none; }
    .item-label { flex: 2; }
    .item-size {
      flex: 1; margin: 0 10px; padding: 6px;
      font-size: 1.1em; border-radius: 4px; border: none;
      background: #333; color: #fff; font-family: Arial;
    }
    .item-price { flex: 1; text-align: right; }
    .add-btn {
      width: 36px; height: 36px; background: #28a745; color: white;
      border: none; border-radius: 50%; font-size: 1.2em;
      line-height: 36px; text-align: center; cursor: pointer;
      margin-left: 10px;
    }
    #orderList { margin-top: 20px; }
    .order-item {
      display: flex; justify-content: space-between;
      align-items: center; margin: 5px 0;
    }
    .order-item span { font-size: 1.05em; }
    .remove-btn {
      background: #dc3545; color: white;
      border: none; border-radius: 5px;
      padding: 5px 10px; cursor: pointer;
    }
    #total {
      text-align: right; font-weight: bold;
      margin-top: 10px; font-size: 1.2em;
    }
    textarea {
      width: 100%; height: 60px; margin-top: 10px;
      padding: 8px; border-radius: 5px; border: 1px solid #444;
      background: #333; color: #fff; font-family: Arial;
    }
    button.submit {
      width: 100%; padding: 14px; margin-top: 15px;
      font-size: 1.2em; background: #28a745; color: white;
      border: none; border-radius: 5px; cursor: pointer;
      font-family: Arial;
    }
    button.submit[disabled] {
      background: grey; cursor: not-allowed;
    }
    button.goBack {
      width: 100%; padding: 12px; margin-top: 10px;
      font-size: 1.1em; background: #888; color: white;
      border: none; border-radius: 5px; cursor: pointer;
      font-family: Arial;
    }

    /* REVIEW SCREEN */
    .review-list { margin: 20px 0; }
    .review-item {
      display: flex; justify-content: space-between;
      border-bottom: 1px dashed #444; padding: 8px 0;
      font-family: Arial;
    }
    .review-item:first-child { border-top: 1px dashed #444; }

    /* SUCCESS SCREEN */
    #successPage h1 { font-size: 1.8em; text-align: center; }
    #orderTicket {
      text-align: center; font-size: 2.2em; margin: 15px 0;
      font-weight: bold; font-family: Arial;
    }
    #successPage p { text-align: center; margin: 10px 0; }

    /* CONFIRM MODAL */
    .modal {
      display: none; position: fixed; top: 0; left: 0;
      width: 100%; height: 100%; background: rgba(0,0,0,0.8);
      justify-content: center; align-items: center;
    }
    .modal-content {
      background: #222; padding: 20px; border-radius: 8px;
      text-align: center; width: 80%; max-width: 300px;
    }
    .modal-content p {
      margin-bottom: 20px; font-size: 1.2em; font-family: Arial;
    }
    .modal-content .btn {
      width: 45%; padding: 10px; margin: 0 5px;
      border: none; border-radius: 5px; font-size: 1em;
      cursor: pointer; font-family: Arial;
    }
    .btn.grey { background: #888; color: white; }
    .btn.green { background: #28a745; color: white; }
  </style>
</head>
<body>

  <!-- WELCOME -->
  <div class="container active" id="welcomePage">
    <h1>Welcome â€” Table {{ table_num }}</h1>
    <button class="submit" onclick="startOrder()">Start Quick Order</button>
  </div>

  <!-- MENU -->
  <div class="container" id="menuPage">
    <h1>Quick Order Menu</h1>

    <h2>Food</h2>
    <ul class="menu-list">
      <!-- Loaded Fries -->
      <li class="menu-item">
        <span class="item-label">Loaded Fries</span>
        <select id="loadedFries" class="item-size"
                onchange="updatePrice('Loaded Fries','loadedFries','price-loadedFries')">
          <option>Regular</option><option selected>Large</option>
        </select>
        <span id="price-loadedFries" class="item-price">Â£4.50</span>
        <button class="add-btn" onclick="addItem('Loaded Fries','loadedFries')">+</button>
      </li>
      <!-- Onion Rings -->
      <li class="menu-item">
        <span class="item-label">Onion Rings</span>
        <select id="onionRings" class="item-size"
                onchange="updatePrice('Onion Rings','onionRings','price-onionRings')">
          <option>Regular</option><option selected>Large</option>
        </select>
        <span id="price-onionRings" class="item-price">Â£3.50</span>
        <button class="add-btn" onclick="addItem('Onion Rings','onionRings')">+</button>
      </li>
      <!-- Korean Chicken Fries -->
      <li class="menu-item">
        <span class="item-label">Korean Chicken Fries</span>
        <select id="koreanFries" class="item-size"
                onchange="updatePrice('Korean Chicken Fries','koreanFries','price-koreanFries')">
          <option>Regular</option><option selected>Large</option>
        </select>
        <span id="price-koreanFries" class="item-price">Â£5.50</span>
        <button class="add-btn" onclick="addItem('Korean Chicken Fries','koreanFries')">+</button>
      </li>
      <!-- Loaded Nachos -->
      <li class="menu-item">
        <span class="item-label">Loaded Nachos</span>
        <select id="nachos" class="item-size"
                onchange="updatePrice('Loaded Nachos','nachos','price-nachos')">
          <option>Regular</option><option selected>Large</option>
        </select>
        <span id="price-nachos" class="item-price">Â£6.00</span>
        <button class="add-btn" onclick="addItem('Loaded Nachos','nachos')">+</button>
      </li>
    </ul>

    <h2>Drinks</h2>
    <ul class="menu-list">
      <!-- Beer -->
      <li class="menu-item">
        <span class="item-label">Beer</span>
        <select id="beer" class="item-size"
                onchange="updatePrice('Beer','beer','price-beer')">
          <option>Half Pint</option><option selected>Pint</option>
        </select>
        <span id="price-beer" class="item-price">Â£3.80</span>
        <button class="add-btn" onclick="addItem('Beer','beer')">+</button>
      </li>
      <!-- Red Wine -->
      <li class="menu-item">
        <span class="item-label">Red Wine</span>
        <select id="redWine" class="item-size"
                onchange="updatePrice('Red Wine','redWine','price-redWine')">
          <option>Small</option><option selected>Large</option><option>Bottle</option>
        </select>
        <span id="price-redWine" class="item-price">Â£5.00</span>
        <button class="add-btn" onclick="addItem('Red Wine','redWine')">+</button>
      </li>
      <!-- White Wine -->
      <li class="menu-item">
        <span class="item-label">White Wine</span>
        <select id="whiteWine" class="item-size"
                onchange="updatePrice('White Wine','whiteWine','price-whiteWine')">
          <option>Small</option><option selected>Large</option><option>Bottle</option>
        </select>
        <span id="price-whiteWine" class="item-price">Â£5.00</span>
        <button class="add-btn" onclick="addItem('White Wine','whiteWine')">+</button>
      </li>
      <!-- Water -->
      <li class="menu-item">
        <span class="item-label">Water</span>
        <select id="water" class="item-size"
                onchange="updatePrice('Water','water','price-water')">
          <option>Regular</option><option selected>Large</option>
        </select>
        <span id="price-water" class="item-price">Â£1.50</span>
        <button class="add-btn" onclick="addItem('Water','water')">+</button>
      </li>
      <!-- Coca Cola -->
      <li class="menu-item">
        <span class="item-label">Coca Cola</span>
        <select id="cocaCola" class="item-size"
                onchange="updatePrice('Coca Cola','cocaCola','price-cocaCola')">
          <option>Regular</option><option selected>Large</option>
        </select>
        <span id="price-cocaCola" class="item-price">Â£2.20</span>
        <button class="add-btn" onclick="addItem('Coca Cola','cocaCola')">+</button>
      </li>
      <!-- Cappuccino -->
      <li class="menu-item">
        <span class="item-label">Cappuccino</span>
        <select id="cappuccino" class="item-size"
                onchange="updatePrice('Cappuccino','cappuccino','price-cappuccino')">
          <option>Regular</option><option selected>Large</option>
        </select>
        <span id="price-cappuccino" class="item-price">Â£2.70</span>
        <button class="add-btn" onclick="addItem('Cappuccino','cappuccino')">+</button>
      </li>
    </ul>

    <div id="orderList"></div>
    <div id="total">Total: Â£0.00</div>

    <textarea id="comments" placeholder="Comments or allergies?"></textarea>
    <button id="reviewBtn" class="submit" onclick="reviewOrder()" disabled>Review Order</button>
  </div>

  <!-- REVIEW -->
  <div class="container" id="reviewPage">
    <h1>Your Order</h1>
    <div class="review-list" id="reviewList"></div>
    <p><strong>Comments:</strong> <span id="reviewComments"></span></p>
    <p><strong>Total:</strong> Â£<span id="reviewTotal"></span></p>
    <button class="submit" onclick="showConfirm()">Place Order Now!</button>
    <button class="goBack" onclick="goBack()">Go Back</button>
  </div>

  <!-- SUCCESS -->
  <div class="container" id="successPage">
    <h1>Order Placed!</h1>
    <div id="orderTicket">Table {{ table_num }} â€” #<span id="orderNumber">0000</span></div>
    <p>Please have payment ready.</p>
    <button class="newOrder" onclick="startOrder()">New Quick Order</button>
  </div>

  <!-- CONFIRM MODAL -->
  <div id="confirmModal" class="modal">
    <div class="modal-content">
      <p>Place order now?</p>
      <button class="btn grey" onclick="closeConfirm()">Go Back</button>
      <button class="btn green" onclick="confirmPlace()">Place Order Now!</button>
    </div>
  </div>

  <script>
    const tableNum = {{ table_num }};
    const endpoint = "{{ url_for('receive_order') }}";
    const testurl  = "{{ url_for('test') }}";
    const prices   = {
      "Loaded Fries Regular":3.00,"Loaded Fries Large":4.50,
      "Onion Rings Regular":2.50,"Onion Rings Large":3.50,
      "Korean Chicken Fries Regular":4.00,"Korean Chicken Fries Large":5.50,
      "Loaded Nachos Regular":4.50,"Loaded Nachos Large":6.00,
      "Beer Half Pint":2.00,"Beer Pint":3.80,
      "Red Wine Small":3.50,"Red Wine Large":5.00,"Red Wine Bottle":12.00,
      "White Wine Small":3.50,"White Wine Large":5.00,"White Wine Bottle":12.00,
      "Water Regular":1.00,"Water Large":1.50,
      "Coca Cola Regular":1.80,"Coca Cola Large":2.20,
      "Cappuccino Regular":2.20,"Cappuccino Large":2.70
    };
    let order = [], known = 0, soundOn = true;

    function startOrder(){
      order=[]; renderOrder();
      document.querySelectorAll('.container').forEach(c=>c.classList.remove('active'));
      document.getElementById('menuPage').classList.add('active');
      updateAllPrices();
    }
    function updatePrice(name, sizeId, priceId){
      const size=document.getElementById(sizeId).value,
            key=name+" "+size,
            p=prices[key]||0;
      document.getElementById(priceId).innerText="Â£"+p.toFixed(2);
    }
    function updateAllPrices(){
      ["loadedFries","onionRings","koreanFries","nachos",
       "beer","redWine","whiteWine","water","cocaCola","cappuccino"]
      .forEach(id=>{
        const map={loadedFries:"Loaded Fries",onionRings:"Onion Rings",
                   koreanFries:"Korean Chicken Fries",nachos:"Loaded Nachos",
                   beer:"Beer",redWine:"Red Wine",whiteWine:"White Wine",
                   water:"Water",cocaCola:"Coca Cola",cappuccino:"Cappuccino"};
        updatePrice(map[id],id,"price-"+id);
      });
    }
    function addItem(name,sizeId){
      const size=document.getElementById(sizeId).value,
            full=name+" "+size,
            ex=order.find(i=>i.name===full);
      ex? ex.quantity++ : order.push({name:full,quantity:1});
      renderOrder();
    }
    function removeItem(i){
      if(--order[i].quantity===0) order.splice(i,1);
      renderOrder();
    }
    function renderOrder(){
      const list=document.getElementById('orderList'),
            btn=document.getElementById('reviewBtn');
      list.innerHTML=''; let total=0;
      order.forEach((it,i)=>{
        const cost=(prices[it.name]||0)*it.quantity; total+=cost;
        list.innerHTML+=`
          <div class="order-item">
            <span>${it.quantity}Ã— ${it.name} (Â£${cost.toFixed(2)})</span>
            <button class="remove-btn" onclick="removeItem(${i})">ðŸ—‘</button>
          </div>`;
      });
      document.getElementById('total').innerText='Total: Â£'+total.toFixed(2);
      btn.disabled = order.length===0;
    }
    function reviewOrder(){
      const comments=document.getElementById('comments').value,
            total=order.reduce((s,i)=>s+(prices[i.name]||0)*i.quantity,0).toFixed(2);
      const rl=document.getElementById('reviewList');
      rl.innerHTML='';
      order.forEach(it=>{
        const c=(prices[it.name]||0)*it.quantity;
        rl.innerHTML+=`
          <div class="review-item">
            <span>${it.quantity}Ã— ${it.name}</span>
            <span>Â£${c.toFixed(2)}</span>
          </div>`;
      });
      document.getElementById('reviewComments').innerText=comments;
      document.getElementById('reviewTotal').innerText=total;
      document.querySelectorAll('.container').forEach(c=>c.classList.remove('active'));
      document.getElementById('reviewPage').classList.add('active');
    }
    function showConfirm(){ document.getElementById('confirmModal').style.display='flex'; }
    function closeConfirm(){ document.getElementById('confirmModal').style.display='none'; }
    function confirmPlace(){
      closeConfirm();
      const comments=document.getElementById('comments').value,
            orderNum=Math.floor(1000+Math.random()*9000);
      fetch(endpoint,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({table:tableNum,order,comments,orderNum})
      })
      .then(r=>{if(!r.ok) throw '';return r.json();})
      .then(_=>{
        document.getElementById('orderNumber').innerText=orderNum;
        document.querySelectorAll('.container').forEach(c=>c.classList.remove('active'));
        document.getElementById('successPage').classList.add('active');
      })
      .catch(_=>alert('Order failed'));
    }
    function goBack(){
      document.querySelectorAll('.container').forEach(c=>c.classList.remove('active'));
      document.getElementById('menuPage').classList.add('active');
    }
    function pingServer(){
      fetch(testurl)
        .then(r=>r.text())
        .then(msg=>document.getElementById('pingResult').innerText='âœ“ '+msg)
        .catch(_=>document.getElementById('pingResult').innerText='âœ— Cannot reach server');
    }
  </script>
</body>
</html>
