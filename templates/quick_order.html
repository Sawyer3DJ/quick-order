<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quick Order â€” Table {{ table_num }}</title>
  <style>
    body {
      font-family: Arial;
      background: linear-gradient(to bottom right, #FF6A13, #1a1a1a) fixed no-repeat;
      background-size: cover; color: white; margin:0; padding:0;
    }
    .container {
      max-width:600px; margin:30px auto; padding:20px;
      background:#222; border-radius:10px; display:none;
    }
    .container.active{display:block;}
    h1,h2 {color:#FF6A13; margin-bottom:10px;}
    .menu-list {list-style:none; margin:0; padding:0;}
    .menu-item {
      display:flex; align-items:center;
      border-bottom:1px solid #444; padding:10px 0;
    }
    .menu-item:last-child{border-bottom:none;}
    .item-label{flex:2;}
    .item-size {
      flex:1; margin:0 10px; padding:6px; font-size:1.1em;
      border:none; border-radius:4px; background:#333; color:#fff;
    }
    .item-price{flex:1; text-align:right;}
    .add-btn {
      width:36px; height:36px; background:#28a745; color:#fff;
      border:none; border-radius:50%; font-size:1.2em; line-height:36px;
      text-align:center; cursor:pointer; margin-left:10px;
    }

    #orderList{margin-top:20px;}
    .order-item {
      display:flex; justify-content:space-between;
      align-items:center; margin:5px 0;
    }
    .order-item span{font-family:Arial; font-size:1.05em;}
    .remove-btn {
      background:#dc3545; color:white;
      border:none; border-radius:5px;
      padding:5px 10px; cursor:pointer;
    }
    #total {
      text-align:right; font-weight:bold;
      margin-top:10px; font-size:1.2em;
      font-family:Arial;
    }
    textarea {
      width:100%; height:60px; margin-top:10px;
      padding:8px; font-family:Arial; font-size:1em;
      border:1px solid #444; border-radius:5px;
      background:#333; color:#fff;
    }

    button.submit {
      width:100%; padding:14px; margin-top:15px;
      font-size:1.2em; font-family:Arial;
      background:#28a745; color:white;
      border:none; border-radius:5px; cursor:pointer;
    }
    button.submit[disabled] {
      background:grey; cursor:not-allowed;
    }
    button.goBack {
      width:100%; padding:12px; margin-top:10px;
      font-size:1.1em; font-family:Arial;
      background:#888; color:white;
      border:none; border-radius:5px; cursor:pointer;
    }

    /* REVIEW PAGE */
    #reviewSummary {margin-bottom:20px;}
    .review-list {margin-bottom:20px;}
    .review-item {
      display:flex; justify-content:space-between;
      border-bottom:1px dashed #444; padding:6px 0;
      font-family:Arial;
    }

    /* SUCCESS PAGE */
    #successPage h1 {font-size:1.8em; text-align:center; font-family:Arial;}
    #orderTicket {
      text-align:center; font-size:2.2em;
      margin:15px 0; font-weight:bold; font-family:Arial;
    }
    #successPage p {text-align:center; font-family:Arial;}

    /* CONFIRM MODAL */
    .modal {
      display:none; position:fixed; top:0; left:0;
      width:100%; height:100%; background:rgba(0,0,0,0.8);
      justify-content:center; align-items:center;
    }
    .modal-content {
      background:#222; padding:20px; border-radius:8px;
      text-align:center; width:80%; max-width:300px;
    }
    .modal-content p {margin-bottom:20px; font-size:1.2em; font-family:Arial;}
    .modal-content .btn {
      width:45%; padding:10px; margin:0 5px;
      border:none; border-radius:5px;
      font-size:1em; cursor:pointer; font-family:Arial;
    }
    .modal-content .grey {background:#888; color:white;}
    .modal-content .green{background:#28a745;color:white;}
  </style>
</head>
<body>

  <!-- WELCOME -->
  <div class="container active" id="welcomePage">
    <h1>Welcome â€” Table {{ table_num }}</h1>
    <button class="submit" onclick="startOrder()">Start Quick Order</button>
  </div>

  <!-- MENU -->
  <div class="container" id="menuPage">
    <h1>Quick Order Menu</h1>

    <h2>Food</h2>
    <ul class="menu-list">
      <!-- ... food items as before ... -->
      <!-- copy in your menu-item blocks from previous version -->
    </ul>

    <h2>Drinks</h2>
    <ul class="menu-list">
      <!-- ... drink items as before ... -->
    </ul>

    <div class="order-list" id="orderList"></div>
    <div id="total">Total: Â£0.00</div>

    <textarea id="comments" placeholder="Comments or allergies?"></textarea>
    <button id="reviewBtn" class="submit" onclick="reviewOrder()" disabled>Review Order</button>
  </div>

  <!-- REVIEW -->
  <div class="container" id="reviewPage">
    <h1>Your Order</h1>
    <div class="review-list" id="reviewList"></div>
    <p><strong>Comments:</strong> <span id="reviewComments"></span></p>
    <p><strong>Total:</strong> Â£<span id="reviewTotal"></span></p>
    <button class="submit" onclick="showConfirm()">Place Order</button>
    <button class="goBack" onclick="goBack()">Go Back</button>
  </div>

  <!-- SUCCESS -->
  <div class="container" id="successPage">
    <h1>Order Placed!</h1>
    <div id="orderTicket">Table {{ table_num }} â€” #<span id="orderNumber">0000</span></div>
    <p>Please have payment ready.</p>
    <button class="goBack" onclick="startOrder()">New Quick Order</button>
  </div>

  <!-- CONFIRM MODAL -->
  <div id="confirmModal" class="modal">
    <div class="modal-content">
      <p>Place Order Now?</p>
      <button class="btn grey" onclick="closeConfirm()">Go Back</button>
      <button class="btn green" onclick="confirmPlace()">Place Order Now!</button>
    </div>
  </div>

  <script>
    const tableNum = {{ table_num }},
          endpoint = "{{ url_for('receive_order') }}",
          testurl  = "{{ url_for('test') }}",
          prices   = { /* your prices map */ };
    let order=[];

    function startOrder(){
      order=[]; renderOrder();
      document.getElementById('comments').value='';
      document.querySelectorAll('.container').forEach(c=>c.classList.remove('active'));
      document.getElementById('menuPage').classList.add('active');
      updateAllPrices();
    }

    function renderOrder(){
      const list=document.getElementById('orderList'),
            btn =document.getElementById('reviewBtn');
      list.innerHTML=''; let total=0;
      order.forEach((it,i)=>{
        const cost=(prices[it.name]||0)*it.quantity;
        total+=cost;
        list.innerHTML+=`
          <div class="order-item">
            <span>${it.quantity}Ã— ${it.name} (Â£${cost.toFixed(2)})</span>
            <button class="remove-btn" onclick="removeItem(${i})">ðŸ—‘</button>
          </div>`;
      });
      document.getElementById('total').innerText='Total: Â£'+total.toFixed(2);
      btn.disabled = order.length===0;
    }

    function reviewOrder(){
      const comments=document.getElementById('comments').value,
            total=order.reduce((s,i)=>s+(prices[i.name]||0)*i.quantity,0).toFixed(2);
      // build review list
      const rl=document.getElementById('reviewList');
      rl.innerHTML='';
      order.forEach(it=>{
        const c=(prices[it.name]||0)*it.quantity;
        rl.innerHTML+=`<div class="review-item">
          <span>${it.quantity}Ã— ${it.name}</span>
          <span>Â£${c.toFixed(2)}</span>
        </div>`;
      });
      document.getElementById('reviewComments').innerText=comments;
      document.getElementById('reviewTotal').innerText=total;
      document.querySelectorAll('.container').forEach(c=>c.classList.remove('active'));
      document.getElementById('reviewPage').classList.add('active');
    }

    function showConfirm(){
      document.getElementById('confirmModal').style.display='flex';
    }
    function closeConfirm(){
      document.getElementById('confirmModal').style.display='none';
    }
    function confirmPlace(){
      closeConfirm();
      const comments=document.getElementById('comments').value,
            orderNum=Math.floor(1000+Math.random()*9000);
      fetch(endpoint,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({table:tableNum, order, comments, orderNum})
      })
      .then(r=>{ if(!r.ok) throw ''; return r.json(); })
      .then(_=>{
        document.getElementById('orderNumber').innerText=orderNum;
        document.querySelectorAll('.container').forEach(c=>c.classList.remove('active'));
        document.getElementById('successPage').classList.add('active');
      })
      .catch(_=>alert('Order failed'));
    }

    function goBack(){
      document.querySelectorAll('.container').forEach(c=>c.classList.remove('active'));
      document.getElementById('menuPage').classList.add('active');
    }

    /* your updatePrice, updateAllPrices, addItem, removeItem, pingServerâ€¦ */
  </script>
</body>
</html>
